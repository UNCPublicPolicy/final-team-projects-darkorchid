---
title: "Merged Data Set and Tests"
output: html_document
date: "2023-03-30"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(tidyverse)






data <- read_csv("/Users/ericleinweber/Desktop/PLCY 715/darkorchid_co2data.csv")

```

```{r, include = FALSE, eval = FALSE, echo = FALSE}


asthma <- asthma %>% filter(FIPS >= 48000, FIPS <= 48507) %>% select(c("Location", "FIPS", `Mortality Rate, 2014*`, `% Change in Mortality Rate, 1980-2014`)) %>% mutate("2014_mortality_ast" = `Mortality Rate, 2014*`, "perc_mortality_change_ast" = `% Change in Mortality Rate, 1980-2014`) %>% select(-c(`% Change in Mortality Rate, 1980-2014`, `Mortality Rate, 2014*`))

chronic_resp <- chronic_resp %>% filter(FIPS >= 48000, FIPS <= 48507) %>% select(c("Location", "FIPS", `Mortality Rate, 2014*`, `% Change in Mortality Rate, 1980-2014`)) %>% mutate("2014_mortality_resp" = `Mortality Rate, 2014*`, "perc_mortality_change_resp" = `% Change in Mortality Rate, 1980-2014`) %>% select(-c(`% Change in Mortality Rate, 1980-2014`, `Mortality Rate, 2014*`))

coal_worker_pneumo <- coal_worker_pneumo %>% filter(FIPS >= 48000, FIPS <= 48507) %>% select(c("Location", "FIPS", `Mortality Rate, 2014*`, `% Change in Mortality Rate, 1980-2014`)) %>% mutate("2014_mortality_cwp" = `Mortality Rate, 2014*`, "perc_mortality_change_cwp" = `% Change in Mortality Rate, 1980-2014`) %>% select(-c(`% Change in Mortality Rate, 1980-2014`, `Mortality Rate, 2014*`))




data_1 <- merge(asthma, chronic_resp, by = c("FIPS", "Location"))
health_outcomes <- merge(data_1, coal_worker_pneumo, by = c("FIPS", "Location"))

write_csv(health_outcomes, "/Users/ericleinweber/Desktop/PLCY 715 GitHub Repository/final-team-projects-darkorchid/DarkOrchid/Leinweber/health_outcomes_TX.csv")
```

```{r}
data <- read_csv("/Users/ericleinweber/Desktop/PLCY 715/darkorchid_co2data.csv")
data <- data %>% rename("FIPS" = "county_id") %>% select(-c("county_state_name", "population_cohort", "employment_cohort", "cohort", "longitude", "latitude")) %>% filter(FIPS >= 48000, FIPS <= 48507)


darkorchid4 <- merge(data, health_outcomes, by = "FIPS")
darkorchid4 <-darkorchid4 %>% select(-c("Location", "state_id", "state"))


write_csv(darkorchid4, "/Users/ericleinweber/Desktop/PLCY 715 GitHub Repository/final-team-projects-darkorchid/DarkOrchid/Leinweber/darkorchid4_TX.csv")


data <- read_csv("/Users/ericleinweber/Desktop/PLCY 715 GitHub Repository/final-team-projects-darkorchid/DarkOrchid/Leinweber/darkorchid4_TX.csv")

data <- data %>% select(-c(`CO2e_output_rate_elec_mton/mwh`))
write_csv(data, "/Users/ericleinweber/Desktop/PLCY 715 GitHub Repository/final-team-projects-darkorchid/DarkOrchid/Leinweber/darkorchid4_TX.csv")

str(data)
```

```{r}
data$coal_plant <- ifelse(data$FIPS == 48175 | data$FIPS == 48149 | data$FIPS ==  48375 | data$FIPS ==  48029 | data$FIPS ==  48293 | data$FIPS ==  48395 | data$FIPS ==  48401 | data$FIPS ==  48157 | data$FIPS ==  48203 | data$FIPS ==  48013 | data$FIPS ==  48309 | data$FIPS ==  48279 | data$FIPS ==  48449, 1, 0)


write_csv(data, "/Users/ericleinweber/Desktop/PLCY 715 GitHub Repository/final-team-projects-darkorchid/DarkOrchid/Leinweber/darkorchid4_TX.csv")




data <- read_csv("/Users/ericleinweber/Desktop/PLCY 715 GitHub Repository/final-team-projects-darkorchid/DarkOrchid/Cleaned Merged Data/darkorchid4_TX.csv")


data$neighboring_plant <- ifelse()


shape <- st_read(system.file("shape/tx.shp", package="sf")) # included with sf package



install.packages("sf")
# a list of neighbors 
neighbors <- st_touches(shape, # first 
                        shape, # second
                        sparse = T)

# neighbors of County Mecklenburg (as in Charlotte of Mecklenburg-Strelitz)

# index of Mecklenburg cnty
idx_strelitz <- which(shape$NAME == 'Mecklenburg') 

# index of neighbors of Mecklenburg cnty
nbr_mecklenburg <- neighbors[idx_strelitz][[1]]

# names of neighbours of cnty Meckl.
shape$NAME[nbr_mecklenburg]
# [1] "Iredell"  "Lincoln"  "Cabarrus" "Gaston"   "Union"   

# a visual check
plot(st_geometry(shape))
plot(shape[idx_strelitz, ], col = "blue", add = T)
plot(shape[nbr_mecklenburg,], col = "red", add = T)
```


#summing all residential electricity 

data <- data %>% group_by(state) %>% mutate(all_res_elec_CO2e = sum(res_elec_CO2e))

#summing all residential natural gas
data <- data %>% group_by(state) %>% mutate(all_res_ng_CO2e = sum(res_ng_CO2e))

#summing all residential data at county level
data <- data %>% group_by(state) %>% mutate(all_res_CO2e_county = res_elec_CO2e + res_ng_CO2e)

#summing all residential data at state level
data <- data %>% group_by(state) %>% mutate(all_res_CO2e_state = all_res_elec_CO2e + all_res_ng_CO2e)


data <- data %>% group_by(state) %>% mutate(all_com_elec_CO2e = sum(com_elec_CO2e))

data <- data %>% group_by(state) %>% mutate(all_com_ng_CO2e = sum(com_ng_CO2e))

#summing all commercial data at county level
data <- data %>% group_by(state) %>% mutate(all_com_CO2e_county = com_elec_CO2e + com_ng_CO2e)

#summing all commercial data at state level
data <- data %>% group_by(state) %>% mutate(all_com_CO2e_state = all_com_elec_CO2e + all_com_ng_CO2e)


data <- data %>% group_by(state) %>% mutate(all_ind_elec_CO2e = sum(ind_elec_CO2e))

data <- data %>% group_by(state) %>% mutate(all_ind_ng_CO2e = sum(ind_ng_CO2e))

#summing all commercial data at state level
data <- data %>% group_by(state) %>% mutate(all_ind_CO2e_county = ind_elec_CO2e + ind_ng_CO2e)

#summing all commercial data at state level
data <- data %>% group_by(state) %>% mutate(all_ind_CO2e_state = all_ind_elec_CO2e + all_ind_ng_CO2e)


data <- data %>% group_by(state) %>% mutate(all_ORT_gas_CO2e = sum(ORT_gas_CO2e))

data <- data %>% group_by(state) %>% mutate(all_ORT_diesel_CO2e = sum(ORT_diesel_CO2e))


#summing all ORT  data at state level
data <- data %>% group_by(state) %>% mutate(all_ORT_CO2e_county = ORT_gas_CO2e + ORT_diesel_CO2e)

#summing all ORT data at state level
data <- data %>% group_by(state) %>% mutate(all_ORT_CO2e_state = all_ORT_gas_CO2e + all_ORT_diesel_CO2e)


