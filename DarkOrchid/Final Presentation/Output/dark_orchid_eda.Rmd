---
title: "Dark Orchid EDA"
author: "Betsy Norwood"
date: "4/14/2023"
output: html_document
---

```{r}

setwd("/Users/betsynorwood/Documents/GitHub/final-team-projects-darkorchid/DarkOrchid/Output")
getwd()

library(tidyverse)
library(ggplot2)
library(dplyr)
library(readr)
library(naniar)
library(patchwork)
library(skimr)
library(GGally)

data <- read.csv("fulldata.csv")

```
An overview of what these variables stand for:

 - fips: Federal Information Processing Standards code, which identifies counties 
 - location: the location of the power plant listed as county, state  
 - county: the county the coal power plant is located in 
 - state: the state the coal power plant is located in 
 - mortality_resp: mortality from respiratory disease per 100,000
 
- perc_mortality_change_resp: 1980 to 2014 
- mortality_ast: mortality of asthma 
- perc_mortality_change_ast: 
mortality_lung: mortality from lung disease 
perc_morality_change_lung: 

 - year: year the values were recorded in (2014)
 - days_with_aqi: days with a recorded AQI within a year time span 

AQI (Air Quality Index) is the EPA's index for reporting air quality. Values range from 0-301+, with the groups of levels of concern as follows: good (0-50), moderate(51-100), unhealthy for sensitive groups (101-150), unhealthy (151-200), very unhealthy (201-300), and hazardous (301 and higher). 
 - good_days: number of days that have AQI values between 0 and 50 
 - moderate_days: number of days that have AQI values between 51 and 100
 - unhealthy_for_sensitive_groups_days: number of days that have AQI values between 101 and 150
 - unhealthy_days: number of days that have AQI values between 151 and 200
 - very_unhealthy_days: number of days that have AQI values between 201 and 300
 - hazardous_days: number of days that have AQI values of 301 or higher 

 - max_aqi: maximum value of the AQI per county 
 - x90th_percentile_aqi: 90th percentile for AQI value per county. 90% of the API values per each county would fall below this value. 
 - median_aqi: median (middle) AQI value per county 
 
days_co: days in which the EPA detector detected this chemical in the air in that year 
days_no2:
days_ozone: 
days_pm2_5: fine, inhalable particulate matter with diameters that are generally 2.5 micrometers or smaller 
days_pm10: inhalable particulate matter with diameters that are generally 10 micrometers or smaller 

 - lat: latitude location of coal power plant 
 - long: longitude location of coal power plant 
 - distance_to_nearest_plant: distance from county centroid (long, lat) to nearest coal fire power plant (long, lat) in meters, calculated by   Haversine formula  
 - name_of_nearest_plant: official name of the coal power plant 

```{r}

glimpse(data)
names(data)

data %>% summarise_all(funs(sum(is.na(.))))

vis_miss(data) 

```
```{r, health plots }

p1 <- ggplot(data, aes(x=mortality_resp)) +
  geom_density(alpha=0.5,show.legend = FALSE, color="darkorchid") +
  theme_minimal()

p2 <- ggplot(data, aes(x=mortality_lung)) +
  geom_density(alpha=0.5,show.legend = FALSE, color="darkorchid") +
  theme_minimal()

p3 <- ggplot(data, aes(x=mortality_ast)) +
  geom_density(alpha=0.5,show.legend = FALSE, color="darkorchid") +
  theme_minimal()

p1+p2+p3
# mortality_resp has a higher median value (~60) compared to mortality_lung(~5) and mortality_ast(~1)
``` 


```{r, AQI plots}

# max_aqi- the majority of the max_aqis recorded in this data set lie at ~100, which is somewhere between the moderate and unhealthy for sensative groups categories. 
ggplot(data, aes(x=max_aqi)) +
  geom_density(alpha=0.5,show.legend = FALSE, color="darkorchid") +
  xlim(0, 500) + # scale for aqi is 0 (good) to 500 (hazardous)
  theme_minimal()

# median_aqi- the average value of the median_aqi is ~40, which is in the good days category 
ggplot(data, aes(x=median_aqi)) +
  geom_histogram(alpha=1)+
  theme_minimal()

# Patchwork of AQI Value Categories 
p1 <- ggplot(data, aes(x=good_days)) +
  geom_density(alpha=0.5,show.legend = FALSE, color="darkorchid") +
  theme_minimal()

p2 <- ggplot(data, aes(x=moderate_days)) +
  geom_density(alpha=0.5,show.legend = FALSE, color="darkorchid") +
  theme_minimal()

p3 <- ggplot(data, aes(x=unhealthy_for_sensitive_groups_days)) +
  geom_density(alpha=0.5,show.legend = FALSE, color="darkorchid") +
  theme_minimal()

p4 <- ggplot(data, aes(x=unhealthy_days)) +
  geom_density(alpha=0.5,show.legend = FALSE, color="darkorchid") +
  theme_minimal()

p5 <- ggplot(data, aes(x=very_unhealthy_days)) +
  geom_density(alpha=0.5,show.legend = FALSE, color="darkorchid") +
  theme_minimal()

p6 <- ggplot(data, aes(x=hazardous_days)) +
  geom_density(alpha=0.5,show.legend = FALSE, color="darkorchid") +
  theme_minimal()

p1 + p2 + p3+ p4 + p5 + p6
```

```{r}

summary(data)

skimmed <- skim(data)
print(skimmed, strip_metadata = FALSE)

data %>% dplyr::select(mortality_resp:days_pm10) %>%
  ggcorr() 

``` 



